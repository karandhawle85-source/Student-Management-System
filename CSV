import csv
import os

FILE_NAME = "students.csv"

# Initialize CSV file if not present
def initialize_file():
    if not os.path.exists(FILE_NAME):
        with open(FILE_NAME, "w", newline="") as file:
            writer = csv.writer(file)
            writer.writerow(["Roll No", "Name", "Age", "Course"]) 


# Add Student
def add_student():
    roll = input("Enter Roll No: ")
    name = input("Enter Name: ")
    age = input("Enter Age: ")
    course = input("Enter Course: ")

    with open(FILE_NAME, "a", newline="") as file:
        writer = csv.writer(file)
        writer.writerow([roll, name, age, course])

    print("\nStudent added successfully!\n")


# View All Students
def view_students():
    print("\n----- ALL STUDENT RECORDS -----\n")

    with open(FILE_NAME, "r") as file:
        reader = csv.reader(file)
        next(reader)

        for row in reader:
            print(f"Roll No: {row[0]}, Name: {row[1]}, Age: {row[2]}, Course: {row[3]}")
    print()


# Search By Roll Number
def search_student():
    roll = input("Enter Roll No to search: ")

    with open(FILE_NAME, "r") as file:
        reader = csv.reader(file)
        next(reader)

        for row in reader:
            if row[0] == roll:
                print(f"\nRecord Found:")
                print(f"Roll No: {row[0]}, Name: {row[1]}, Age: {row[2]}, Course: {row[3]}\n")
                return

    print("\nNo student found with that Roll No.\n")


# Update Student
def update_student():
    roll = input("Enter Roll No to update: ")
    updated = False
    rows = []

    with open(FILE_NAME, "r") as file:
        reader = csv.reader(file)
        rows = list(reader)

    for i in range(1, len(rows)):
        if rows[i][0] == roll:
            print("\nEnter New Details:")
            rows[i][1] = input("New Name: ")
            rows[i][2] = input("New Age: ")
            rows[i][3] = input("New Course: ")
            updated = True
            break

    if updated:
        with open(FILE_NAME, "w", newline="") as file:
            writer = csv.writer(file)
            writer.writerows(rows)
        print("\nRecord Updated Successfully!\n")
    else:
        print("\nRoll No not found.\n")


# Delete Student
def delete_student():
    roll = input("Enter Roll No to delete: ")
    deleted = False
    rows = []

    with open(FILE_NAME, "r") as file:
        reader = csv.reader(file)
        rows = list(reader)

    new_rows = [rows[0]]  # keep header

    for row in rows[1:]:
        if row[0] == roll:
            deleted = True
            continue
        new_rows.append(row)

    if deleted:
        with open(FILE_NAME, "w", newline="") as file:
            writer = csv.writer(file)
            writer.writerows(new_rows)
        print("\nRecord Deleted Successfully!\n")
    else:
        print("\nRoll No not found.\n")


# Main Menu
def menu():
    initialize_file()

    while True:
        print("===== STUDENT MANAGEMENT SYSTEM =====")
        print("1. Add Student")
        print("2. View All Students")
        print("3. Search Student")
        print("4. Update Student")
        print("5. Delete Student")
        print("6. Exit")

        choice = input("\nEnter your choice: ")

        if choice == "1":
            add_student()
        elif choice == "2":
            view_students()
        elif choice == "3":
            search_student()
        elif choice == "4":
            update_student()
        elif choice == "5":
            delete_student()
        elif choice == "6":
            print("Exiting...")
            break
        else:
            print("\nInvalid choice! Try again.\n")


menu()
